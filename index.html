<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ring Tap ‚Äî Telegram Mini‚ÄëGame</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg:#0f1220; --card:#181b2e; --accent:#7c5cff; --text:#e9ecff; --muted:#9aa0c3; --ok:#3ad29f;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background: radial-gradient(1200px 600px at 50% -10%, #1a1e35, #0f1220); color: var(--text); display: grid; place-items: center; }
    .app { width: 100%; max-width: 480px; padding: 18px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .title { font-weight: 800; font-size: 20px; letter-spacing: 0.2px; }
    .muted { color: var(--muted); font-size: 14px; }
    .hud { margin: 14px 0 10px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    .pill { background: #0f1220; border: 1px solid rgba(255,255,255,0.06); border-radius: 999px; padding: 8px 12px; text-align: center; }
    .arena { display: grid; place-items: center; height: 360px; position: relative; margin: 6px 0 10px; }
    .target { width: 96px; height: 96px; border-radius: 999px; background: radial-gradient(60px 60px at 35% 35%, #a999ff, #7c5cff 60%, #5c3fff); box-shadow: 0 10px 30px rgba(124,92,255,0.45); display: grid; place-items: center; cursor: pointer; user-select: none; }
    .target:active { transform: scale(0.98); }
    .score { font-weight: 700; font-size: 14px; opacity: 0.92; }
    .btn { width: 100%; appearance: none; border: 0; background: var(--accent); color: white; border-radius: 12px; padding: 14px 16px; font-weight: 700; font-size: 16px; cursor: pointer; box-shadow: 0 12px 22px rgba(124,92,255,0.35); }
    .btn:disabled { opacity: 0.5; }
    .ok { background: var(--ok); box-shadow: 0 12px 22px rgba(58,210,159,0.35); }
    .footer { text-align:center; margin-top: 10px; font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="row">
        <div class="title">Ring Tap</div>
        <div class="muted" id="hello"></div>
      </div>
      <div class="hud">
        <div class="pill">‚è± <span id="time">20</span>s</div>
        <div class="pill">üéØ <span id="hits">0</span></div>
        <div class="pill">‚≠êÔ∏è Best: <span id="best">0</span></div>
      </div>
      <div class="arena">
        <div id="target" class="target"><div class="score" id="tap">TAP</div></div>
      </div>
      <button id="start" class="btn">Start</button>
      <button id="submit" class="btn ok" disabled>Submit score</button>
      <div class="footer">Made for Telegram Web App ‚Ä¢ closes automatically after submit</div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      tg.setHeaderColor('#0f1220');
      tg.setBackgroundColor('#0f1220');
    }

    const hello = document.getElementById('hello');
    const name = tg?.initDataUnsafe?.user?.first_name || 'friend';
    hello.textContent = `Hi, ${name}`;

    const target = document.getElementById('target');
    const startBtn = document.getElementById('start');
    const submitBtn = document.getElementById('submit');
    const timeEl = document.getElementById('time');
    const hitsEl = document.getElementById('hits');
    const bestEl = document.getElementById('best');

    let timeLeft = 20;
    let hits = 0;
    let timer = null;

    bestEl.textContent = localStorage.getItem('ringtap_best') || '0';

    function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function moveTarget() {
      const arena = document.querySelector('.arena');
      const rect = arena.getBoundingClientRect();
      const size = 96;
      const x = rand(0, rect.width - size);
      const y = rand(0, rect.height - size);
      target.style.position = 'absolute';
      target.style.left = x + 'px';
      target.style.top = y + 'px';
    }

    function reset() {
      timeLeft = 20; hits = 0;
      timeEl.textContent = timeLeft;
      hitsEl.textContent = hits;
      submitBtn.disabled = true;
      startBtn.disabled = false;
      moveTarget();
    }

    function tick() {
      timeLeft -= 1;
      timeEl.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timer); timer = null;
        const best = Math.max(parseInt(bestEl.textContent||'0'), hits);
        bestEl.textContent = best.toString();
        localStorage.setItem('ringtap_best', best.toString());
        submitBtn.disabled = false;
        startBtn.disabled = false;
      }
    }

    startBtn.addEventListener('click', () => {
      reset();
      startBtn.disabled = true;
      submitBtn.disabled = true;
      moveTarget();
      timer = setInterval(tick, 1000);
    });

    target.addEventListener('click', () => {
      if (!timer) return; // game not running
      hits += 1;
      hitsEl.textContent = hits;
      moveTarget();
    });

    submitBtn.addEventListener('click', () => {
      const payload = { game: 'ringtap', score: hits };
      if (tg && tg.sendData) {
        tg.sendData(JSON.stringify(payload));
        tg.close();
      } else {
        alert('Telegram WebApp context not found. Open from the bot.');
      }
    });

    // Initial position
    moveTarget();
  </script>
</body>
</html>

